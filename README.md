# Kontext å¯è§†åŒ–æç¤ºè¯çª—å£

![Kontext Visual Prompt Window](images/KontextVisualPromptWindow.png)

ğŸ¨ æ¸è¿›å¼æ™ºèƒ½å›¾åƒç¼–è¾‘ç³»ç»Ÿï¼Œé€šè¿‡ä¸‰ä¸ªå‘å±•é˜¶æ®µé€æ­¥å®ç°ä»**æ‰‹åŠ¨æ ‡æ³¨**åˆ°**æ™ºèƒ½åˆ†å‰²**å†åˆ°**ä¸“ä¸šè°ƒè‰²**çš„å®Œæ•´å·¥ä½œæµã€‚

## äº§å“å‘å±•è·¯çº¿å›¾

### ğŸš€ ç¬¬ä¸€é˜¶æ®µï¼šæ‰‹åŠ¨æ ‡æ³¨ä¸åŸºç¡€æç¤ºè¯
**å½“å‰å®ç°çŠ¶æ€**: âœ… **å·²å®Œæˆ**

#### æ ¸å¿ƒåŠŸèƒ½
- **ğŸ¨ è‡ªç”±æ‰‹åŠ¨æ ‡æ³¨**
  - çŸ©å½¢ã€åœ†å½¢ã€ç®­å¤´ã€å¤šè¾¹å½¢ç»˜åˆ¶å·¥å…·
  - å®å¿ƒ/ç©ºå¿ƒæ ·å¼åˆ‡æ¢
  - å¤šé¢œè‰²æ”¯æŒå’Œå¤šé€‰åŠŸèƒ½
  - å®Œæ•´çš„ç¼–è¾‘ã€æ’¤é”€ã€æ¸…ç©ºåŠŸèƒ½
  - ğŸ·ï¸ **ç¼–å·æ§åˆ¶**: å¯é€‰æ‹©æ˜¯å¦åœ¨æ ‡æ³¨å’Œæç¤ºè¯ä¸­æ˜¾ç¤ºç¼–å·

- **ğŸ“ ç»“æ„åŒ–æç¤ºè¯è¾“å‡º**
  - åŸºäºæ ‡æ³¨åŒºåŸŸçš„åŸºç¡€æç¤ºè¯æ¨¡æ¿
  - 12ç§æ“ä½œç±»å‹æ”¯æŒï¼ˆé¢œè‰²å˜æ¢ã€é£æ ¼è½¬æ¢ç­‰ï¼‰
  - è‡ªå®šä¹‰ç¼–è¾‘æè¿°è¾“å…¥
  - è´¨é‡åˆ†æå’Œä¼˜åŒ–å»ºè®®

- **ğŸ¯ æ©ç æ•°æ®è¾“å‡º**
  - æ ‡æ³¨è½¬ComfyUIæ©ç æ ¼å¼
  - å¤šç§æ©ç æ¨¡å¼ï¼ˆé€‰ä¸­å›¾å±‚ã€å…¨éƒ¨å›¾å±‚ã€åé€‰ï¼‰
  - ç¾½åŒ–è¾¹ç¼˜å¤„ç†

### ğŸ”® ç¬¬äºŒé˜¶æ®µï¼šæ™ºèƒ½åˆ†å‰²ä¸AIæç¤ºè¯
**å¼€å‘çŠ¶æ€**: ğŸš§ **è§„åˆ’ä¸­**

#### è®¡åˆ’åŠŸèƒ½
- **ğŸ¤– è¯­ä¹‰åˆ†å‰²è‡ªåŠ¨æ ‡æ³¨**
  - é›†æˆå…ˆè¿›çš„åˆ†å‰²æ¨¡å‹ï¼ˆSAMã€GroundingDINOç­‰ï¼‰
  - è‡ªåŠ¨è¯†åˆ«å¹¶ç”Ÿæˆå¯é€‰å›¾å±‚æ ‡æ³¨
  - æ™ºèƒ½ç‰©ä½“è¯†åˆ«å’Œåˆ†ç±»
  - ä¸€é”®å…¨å›¾è¯­ä¹‰åˆ†å‰²

- **ğŸ§  å¤§è¯­è¨€æ¨¡å‹æç¤ºè¯ç”Ÿæˆ**
  - é›†æˆChatGPT/DeepSeekç­‰å¤§æ¨¡å‹
  - åŸºäºå›¾åƒå†…å®¹çš„æ™ºèƒ½æç¤ºè¯ç”Ÿæˆ
  - ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ç¼–è¾‘å»ºè®®
  - å¤šè¯­è¨€æç¤ºè¯æ”¯æŒ

- **ğŸ“ ç»“æ„åŒ–æç¤ºè¯ä¼˜åŒ–ä¸è°ƒè¯•**
  - æ·±åº¦ä¼˜åŒ–Kontextä¸“ç”¨æç¤ºè¯æ¨¡æ¿
  - äº”ç»´ç»“æ„åŒ–æç¤ºè¯ä½“ç³»ï¼šå¯¹è±¡+æ“ä½œ+å‚æ•°+ä¿®é¥°+çº¦æŸ
  - æ™ºèƒ½æç¤ºè¯è´¨é‡è¯„ä¼°å’Œä¼˜åŒ–å»ºè®®
  - A/Bæµ‹è¯•æ¡†æ¶ï¼Œå¯»æ‰¾æœ€é€‚åˆçš„æç¤ºè¯æ¨¡å¼

### âœ¨ ç¬¬ä¸‰é˜¶æ®µï¼šä¸“ä¸šè°ƒè‰²ä¸ç¯å¢ƒè°ƒæ•´
**å¼€å‘çŠ¶æ€**: ğŸ“‹ **æ¦‚å¿µè®¾è®¡**

#### æ„¿æ™¯åŠŸèƒ½
- **ğŸ¨ ä¸“ä¸šè°ƒè‰²ç³»ç»Ÿ**
  - è‰²æ¸©è°ƒèŠ‚ï¼ˆå†·æš–è‰²è°ƒå¹³è¡¡ï¼‰
  - è‰²è°ƒæ˜ å°„å’Œé¢œè‰²æ ¡æ­£
  - äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ç²¾ç»†æ§åˆ¶
  - HSLé¢œè‰²ç©ºé—´ä¸“ä¸šè°ƒèŠ‚

- **ğŸŒ… ç¯å¢ƒå…‰çº¿ç³»ç»Ÿ**
  - æ™ºèƒ½å…‰çº¿åˆ†æå’Œé‡å»º
  - ç¯å¢ƒå…‰ã€ä¸»å…‰ã€è¡¥å…‰ç‹¬ç«‹è°ƒèŠ‚
  - é˜´å½±å’Œé«˜å…‰ç»†èŠ‚æ¢å¤
  - çœŸå®æ„Ÿå…‰çº¿æ•ˆæœæ¨¡æ‹Ÿ

- **ğŸ­ é£æ ¼è½¬æ¢å¼•æ“**
  - è‰ºæœ¯é£æ ¼è¿ç§»ï¼ˆæ²¹ç”»ã€æ°´å½©ã€ç´ æç­‰ï¼‰
  - æ‘„å½±é£æ ¼æ¨¡æ‹Ÿï¼ˆèƒ¶ç‰‡ã€æ•°ç ã€é»‘ç™½ç­‰ï¼‰
  - è‡ªå®šä¹‰é£æ ¼è®­ç»ƒå’Œåº”ç”¨

## ç¬¬ä¸€é˜¶æ®µåŠŸèƒ½è¯¦æƒ…

### ğŸ”§ ç»˜åˆ¶å·¥å…·
- **çŸ©å½¢**: æ‹–æ‹½ç»˜åˆ¶çŸ©å½¢æ ‡æ³¨
- **åœ†å½¢**: æ‹–æ‹½ç»˜åˆ¶æ¤­åœ†ï¼ŒShifté”®ç»˜åˆ¶æ­£åœ†
- **ç®­å¤´**: æ‹–æ‹½ç»˜åˆ¶æŒ‡å‘ç®­å¤´
- **è‡ªç”±ç»˜åˆ¶**: å·¦å‡»æ·»åŠ é”šç‚¹ï¼Œå³å‡»é—­åˆå¤šè¾¹å½¢
- **æ©¡çš®æ“¦**: ç‚¹å‡»åˆ é™¤æ ‡æ³¨

### ğŸ¨ æ ·å¼é€‰é¡¹
- **é¢œè‰²é€‰æ‹©**: çº¢ã€ç»¿ã€é»„ã€è“å››ç§é¢œè‰²
- **å¡«å……æ¨¡å¼**: å®å¿ƒ/ç©ºå¿ƒåˆ‡æ¢
- **å¤šé€‰æ”¯æŒ**: åŒæ—¶é€‰æ‹©å¤šä¸ªæ ‡æ³¨å¯¹è±¡
- **ğŸ·ï¸ ç¼–å·æ§åˆ¶**: å‹¾é€‰æ¡†æ§åˆ¶ç¼–å·æ˜¾ç¤ºï¼ˆå‰ç«¯æ ‡æ³¨ç¼–å·å’Œåç«¯å›¾åƒç¼–å·åŒæ­¥ï¼‰

### ğŸ“ æç¤ºè¯æ¨¡æ¿
- **é¢œè‰²å˜æ¢**: æ”¹å˜é€‰ä¸­åŒºåŸŸçš„é¢œè‰²
- **é£æ ¼è½¬æ¢**: åº”ç”¨è‰ºæœ¯é£æ ¼åˆ°é€‰ä¸­åŒºåŸŸ
- **èƒŒæ™¯æ›¿æ¢**: æ›¿æ¢é€‰ä¸­åŒºåŸŸçš„èƒŒæ™¯
- **ç‰©ä½“æ›¿æ¢**: æ›¿æ¢é€‰ä¸­çš„ç‰©ä½“
- **ç‰©ä½“ç§»é™¤**: ç§»é™¤é€‰ä¸­çš„ç‰©ä½“
- **è´¨æ„Ÿä¿®æ”¹**: æ”¹å˜è¡¨é¢è´¨æ„Ÿ
- **å§¿æ€è°ƒæ•´**: è°ƒæ•´äººç‰©å§¿æ€
- **è¡¨æƒ…ä¿®æ”¹**: ä¿®æ”¹é¢éƒ¨è¡¨æƒ…
- **æœè£…æ›´æ¢**: æ›´æ¢æœè£…æ ·å¼
- **ç¯å¢ƒä¿®æ”¹**: ä¿®æ”¹ç¯å¢ƒè®¾å®š
- **è´¨é‡å¢å¼º**: æå‡å›¾åƒè´¨é‡
- **è‡ªå®šä¹‰æ“ä½œ**: ç”¨æˆ·è‡ªå®šä¹‰ç¼–è¾‘æŒ‡ä»¤

## ç»“æ„åŒ–æç¤ºè¯ä½“ç³»ï¼ˆç¬¬äºŒé˜¶æ®µé¢„è§ˆï¼‰

### ğŸ—ï¸ äº”ç»´æç¤ºè¯ç»“æ„
Kontextä¸“ç”¨çš„ç»“æ„åŒ–æç¤ºè¯éµå¾ªäº”ä¸ªæ ¸å¿ƒç»´åº¦ï¼Œç¡®ä¿ç²¾ç¡®ã€å¯æ§çš„å›¾åƒç¼–è¾‘æ•ˆæœï¼š

#### ğŸ“ 1. å¯¹è±¡ï¼ˆObjectï¼‰
- **å®šä¹‰**: æ˜ç¡®æŒ‡å®šè¦ç¼–è¾‘çš„åŒºåŸŸæˆ–å¯¹è±¡
- **æ ¼å¼**: `the [é¢œè‰²] [å½¢çŠ¶] marked area (annotation [ç¼–å·])`
- **ç¤ºä¾‹**: `the red rectangular marked area (annotation 1)`

#### âš™ï¸ 2. æ“ä½œç±»å‹ï¼ˆOperationï¼‰
- **å®šä¹‰**: å…·ä½“çš„ç¼–è¾‘åŠ¨ä½œç±»å‹
- **ç±»å‹**: 
  - `change_color` - é¢œè‰²å˜æ¢
  - `replace_object` - ç‰©ä½“æ›¿æ¢
  - `remove_object` - ç‰©ä½“ç§»é™¤
  - `change_style` - é£æ ¼è½¬æ¢
  - `change_texture` - è´¨æ„Ÿä¿®æ”¹

#### ğŸ¯ 3. å‚æ•°ï¼ˆParametersï¼‰
- **å®šä¹‰**: æ“ä½œçš„å…·ä½“ç›®æ ‡å€¼æˆ–æè¿°
- **æ ¼å¼**: ç”¨æˆ·è¾“å…¥çš„ç›®æ ‡æè¿°
- **ç¤ºä¾‹**: `"red color"`, `"cartoon style"`, `"smooth texture"`

#### âœ¨ 4. ä¿®é¥°ï¼ˆModifiersï¼‰
- **å®šä¹‰**: å¯é€‰çš„è´¨é‡å¢å¼ºè¯æ±‡ï¼ˆç”¨æˆ·æ§åˆ¶ï¼‰
- **ç±»å‹**: 
  - è´¨é‡ä¿®é¥°: `high quality`, `8k resolution`, `professional`
  - é£æ ¼ä¿®é¥°: `realistic`, `artistic`, `photorealistic`
  - æŠ€æœ¯ä¿®é¥°: `sharp focus`, `detailed`, `masterpiece`

#### ğŸ”’ 5. çº¦æŸï¼ˆConstraintsï¼‰
- **å®šä¹‰**: å¯é€‰çš„é™åˆ¶æ¡ä»¶ï¼ˆç”¨æˆ·æ§åˆ¶ï¼‰
- **ç±»å‹**:
  - ä¿æŒçº¦æŸ: `maintaining lighting`, `preserving composition`
  - é›†æˆçº¦æŸ: `natural integration`, `seamless blending`
  - ä¸€è‡´æ€§çº¦æŸ: `consistent style`, `matching perspective`

### ğŸ“ æç¤ºè¯ç”Ÿæˆç¤ºä¾‹

#### åŸºç¡€ç‰ˆæœ¬ï¼ˆç¬¬ä¸€é˜¶æ®µï¼Œå½“å‰å®ç°ï¼‰
```
è¾“å…¥: å¯¹è±¡="çº¢è‰²çŸ©å½¢åŒºåŸŸ", æ“ä½œ="å˜è‰²", å‚æ•°="è“è‰²"
è¾“å‡º: "Change the color of the red marked area to blue"
```

#### ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆç¬¬äºŒé˜¶æ®µï¼Œè§„åˆ’ä¸­ï¼‰
```
è¾“å…¥: 
- å¯¹è±¡="çº¢è‰²çŸ©å½¢åŒºåŸŸ" 
- æ“ä½œ="å˜è‰²" 
- å‚æ•°="è“è‰²"
- ä¿®é¥°="é«˜è´¨é‡ï¼Œä¸“ä¸š"
- çº¦æŸ="ä¿æŒå…‰ç…§ï¼Œè‡ªç„¶èåˆ"

è¾“å‡º: "Change the color of the red rectangular marked area to blue, high quality, professional, maintaining lighting, natural integration"
```

### ğŸ¯ ç”¨æˆ·æ§åˆ¶åŸåˆ™
- **é»˜è®¤ç®€æ´**: ç³»ç»Ÿé»˜è®¤åªç”Ÿæˆæ ¸å¿ƒç»“æ„ï¼ˆå¯¹è±¡+æ“ä½œ+å‚æ•°ï¼‰
- **ç”¨æˆ·é€‰æ‹©**: ä¿®é¥°è¯å’Œçº¦æŸè¯å®Œå…¨ç”±ç”¨æˆ·å†³å®šæ˜¯å¦æ·»åŠ 
- **æ¨¡æ¿ä¼˜åŒ–**: é€šè¿‡AIæµ‹è¯•æ‰¾åˆ°æœ€é€‚åˆä¸åŒæ¨¡å‹çš„æç¤ºè¯æ¨¡æ¿
- **è´¨é‡è¯„ä¼°**: è‡ªåŠ¨åˆ†ææç¤ºè¯è´¨é‡å¹¶æä¾›ä¼˜åŒ–å»ºè®®

## å®‰è£…ä½¿ç”¨

### ğŸ“¦ å®‰è£…

#### æ–¹å¼ä¸€ï¼šGitå®‰è£…ï¼ˆæ¨èï¼‰
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/aiaiaikkk/KontextVisualPromptWindow.git
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…
1. ä¸‹è½½å¹¶è§£å‹é¡¹ç›®æ–‡ä»¶
2. å°†æ•´ä¸ª`KontextVisualPromptWindow`æ–‡ä»¶å¤¹å¤åˆ¶åˆ°`ComfyUI/custom_nodes/`ç›®å½•

#### å®Œæˆå®‰è£…
é‡å¯ComfyUIå³å¯ä½¿ç”¨

### ğŸš€ ä½¿ç”¨æ–¹æ³•

#### ç¬¬ä¸€é˜¶æ®µå·¥ä½œæµï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰

##### åŸºç¡€æ¨¡å¼ï¼ˆæ¨èï¼‰
```
LoadImage â†’ VisualPromptEditor
```
- **åŠŸèƒ½**: æ‰‹åŠ¨æ ‡æ³¨ + åŸºç¡€æç¤ºè¯ç”Ÿæˆ
- **é€‚ç”¨**: ç²¾ç¡®æ§åˆ¶æ ‡æ³¨ï¼Œé€‚åˆä¸“ä¸šç”¨æˆ·

##### å®Œæ•´æ¨¡å¼
```
LoadImage â†’ VisualPromptEditor â†’ LayerToMaskNode
```
- **åŠŸèƒ½**: æ‰‹åŠ¨æ ‡æ³¨ + æç¤ºè¯ + æ©ç è¾“å‡º
- **é€‚ç”¨**: éœ€è¦æ©ç æ•°æ®ç”¨äºåç»­ComfyUIå·¥ä½œæµ

#### ç¬¬äºŒé˜¶æ®µå·¥ä½œæµï¼ˆè§„åˆ’ä¸­ï¼‰

##### æ™ºèƒ½åˆ†å‰²æ¨¡å¼
```
LoadImage â†’ SemanticSegmentationNode â†’ VisualPromptEditor â†’ AIPromptGenerator
```
- **åŠŸèƒ½**: è‡ªåŠ¨åˆ†å‰² + æ‰‹åŠ¨è°ƒæ•´ + AIæç¤ºè¯
- **é€‚ç”¨**: å¿«é€Ÿå¤„ç†ï¼Œé€‚åˆæ‰¹é‡ç¼–è¾‘

##### æç¤ºè¯ä¼˜åŒ–æ¨¡å¼
```
LoadImage â†’ VisualPromptEditor â†’ PromptOptimizer â†’ QualityAnalyzer
```
- **åŠŸèƒ½**: æ‰‹åŠ¨æ ‡æ³¨ + ç»“æ„åŒ–æç¤ºè¯ä¼˜åŒ– + è´¨é‡è¯„ä¼°
- **é€‚ç”¨**: ä¸“ä¸šç”¨æˆ·ï¼Œè¿½æ±‚æœ€ä½³æç¤ºè¯æ•ˆæœ

#### ç¬¬ä¸‰é˜¶æ®µå·¥ä½œæµï¼ˆæ¦‚å¿µä¸­ï¼‰

##### ä¸“ä¸šè°ƒè‰²æ¨¡å¼
```
LoadImage â†’ GlobalColorGrading â†’ LocalAnnotationEditing â†’ ProfessionalLightingAdjustment
```
- **åŠŸèƒ½**: å…¨å›¾è°ƒè‰² + å±€éƒ¨ç¼–è¾‘ + å…‰çº¿è°ƒæ•´
- **é€‚ç”¨**: ä¸“ä¸šæ‘„å½±å¸ˆå’Œè®¾è®¡å¸ˆ

### ğŸ¯ æ“ä½œæŒ‡å—

#### åŸºæœ¬æ“ä½œ
1. **æ‰“å¼€ç¼–è¾‘å™¨**: åŒå‡»`VisualPromptEditor`èŠ‚ç‚¹
2. **é€‰æ‹©å·¥å…·**: ç‚¹å‡»å·¥å…·æ ä¸­çš„ç»˜åˆ¶å·¥å…·
3. **é€‰æ‹©é¢œè‰²**: ç‚¹å‡»é¢œè‰²æŒ‰é’®é€‰æ‹©æ ‡æ³¨é¢œè‰²
4. **åˆ‡æ¢æ ·å¼**: ç‚¹å‡»"Fill"æŒ‰é’®åˆ‡æ¢å®å¿ƒ/ç©ºå¿ƒ
5. **ç¼–å·æ§åˆ¶**: å‹¾é€‰/å–æ¶ˆ"Include annotation numbers"æ§åˆ¶ç¼–å·æ˜¾ç¤º
6. **ç»˜åˆ¶æ ‡æ³¨**: åœ¨å›¾åƒä¸Šæ‹–æ‹½æˆ–ç‚¹å‡»ç»˜åˆ¶
7. **ä¿å­˜åº”ç”¨**: ç‚¹å‡»"Save & Apply"ä¿å­˜æ•°æ®

#### å¿«æ·é”®
- **Ctrl + æ»šè½®**: ç¼©æ”¾å›¾åƒ
- **ä¸­é”®æ‹–æ‹½**: å¹³ç§»å›¾åƒ
- **Shift + åœ†å½¢**: ç»˜åˆ¶æ­£åœ†
- **å³é”®**: ç»“æŸè‡ªç”±ç»˜åˆ¶

## èŠ‚ç‚¹è¯´æ˜

### ğŸ¨ VisualPromptEditor
**ä¸»è¦èŠ‚ç‚¹**
- **è¾“å…¥**: IMAGE
- **è¾“å‡º**: å¤„ç†åå›¾åƒã€æç¤ºè¯ã€æ©ç æ•°æ®ç­‰
- **åŠŸèƒ½**: å¯è§†åŒ–æ ‡æ³¨ç¼–è¾‘å’Œæç¤ºè¯ç”Ÿæˆ

### ğŸ¤– IntelligentAnnotationNode
**æ™ºèƒ½æ ‡æ³¨èŠ‚ç‚¹**
- **è¾“å…¥**: IMAGE
- **è¾“å‡º**: æ£€æµ‹åˆ°çš„å›¾å±‚æ•°æ®JSON
- **åŠŸèƒ½**: è‡ªåŠ¨å¯¹è±¡æ£€æµ‹å’ŒåŒºåŸŸåˆ†å‰²

### ğŸ­ LayerToMaskNode
**å›¾å±‚è½¬æ©ç èŠ‚ç‚¹**
- **è¾“å…¥**: å›¾å±‚æ•°æ®JSON
- **è¾“å‡º**: ComfyUIæ©ç æ ¼å¼
- **åŠŸèƒ½**: æ ‡æ³¨æ•°æ®è½¬æ¢ä¸ºæ©ç 


## è®¸å¯è¯

MIT License - è¯¦è§LICENSEæ–‡ä»¶

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åœ¨GitHubä»“åº“ä¸­æäº¤Issueã€‚

---

ğŸŒŸ **Kontext Visual Prompt Window** - è®©å›¾åƒç¼–è¾‘æ›´æ™ºèƒ½ã€æ›´ç›´è§‚ï¼

---

# Kontext Visual Prompt Window

![Kontext Visual Prompt Window](images/KontextVisualPromptWindow.png)

ğŸ¨ A progressive intelligent image editing system that evolves through three development stages from **manual annotation** to **intelligent segmentation** to **professional color grading**.

## Product Development Roadmap

### ğŸš€ Stage 1: Manual Annotation & Basic Prompts
**Current Implementation Status**: âœ… **Completed**

#### Core Features
- **ğŸ¨ Free Manual Annotation**
  - Rectangle, circle, arrow, polygon drawing tools
  - Toggle between filled/outline styles
  - Multi-color support and multi-selection
  - Complete editing, undo, clear functionality
  - ğŸ·ï¸ **Number Control**: Optional display of annotation numbers in annotations and prompts

- **ğŸ“ Structured Prompt Output**
  - Basic prompt templates based on annotated regions
  - 12 operation types (color transformation, style transfer, etc.)
  - Custom editing description input
  - Quality analysis and optimization suggestions

- **ğŸ¯ Mask Data Output**
  - Convert annotations to ComfyUI mask format
  - Multiple mask modes (selected layers, all layers, inverted)
  - Feathered edge processing

### ğŸ”® Stage 2: Intelligent Segmentation & AI Prompts
**Development Status**: ğŸš§ **In Planning**

#### Planned Features
- **ğŸ¤– Semantic Segmentation Auto-annotation**
  - Integrate advanced segmentation models (SAM, GroundingDINO, etc.)
  - Automatically identify and generate selectable layer annotations
  - Intelligent object recognition and classification
  - One-click full image semantic segmentation

- **ğŸ§  LLM-powered Prompt Generation**
  - Integrate ChatGPT/DeepSeek and other LLMs
  - Intelligent prompt generation based on image content
  - Context-aware editing suggestions
  - Multi-language prompt support

- **ğŸ“ Structured Prompt Optimization & Debugging**
  - Deep optimization of Kontext-specific prompt templates
  - Five-dimensional structured prompt system: Object + Operation + Parameters + Modifiers + Constraints
  - Intelligent prompt quality assessment and optimization suggestions
  - A/B testing framework to find optimal prompt patterns

### âœ¨ Stage 3: Professional Color Grading & Environmental Adjustment
**Development Status**: ğŸ“‹ **Conceptual Design**

#### Vision Features
- **ğŸ¨ Professional Color Grading System**
  - Color temperature adjustment (cool/warm balance)
  - Tone mapping and color correction
  - Fine control of brightness, contrast, saturation
  - Professional HSL color space adjustment

- **ğŸŒ… Environmental Lighting System**
  - Intelligent lighting analysis and reconstruction
  - Independent control of ambient, key, and fill lighting
  - Shadow and highlight detail recovery
  - Realistic lighting effect simulation

- **ğŸ­ Style Transfer Engine**
  - Artistic style transfer (oil painting, watercolor, sketch, etc.)
  - Photography style simulation (film, digital, black & white, etc.)
  - Custom style training and application

## Stage 1 Feature Details

### ğŸ”§ Drawing Tools
- **Rectangle**: Drag to draw rectangular annotations
- **Circle**: Drag to draw ellipse, Shift for perfect circle
- **Arrow**: Drag to draw directional arrows
- **Freehand**: Left-click to add anchor points, right-click to close polygon
- **Eraser**: Click to delete annotations

### ğŸ¨ Style Options
- **Color Selection**: Red, green, yellow, blue colors
- **Fill Mode**: Toggle between filled/outline styles
- **Multi-selection**: Select multiple annotation objects simultaneously
- **ğŸ·ï¸ Number Control**: Checkbox to control number display (frontend annotation numbers and backend image numbers synchronized)

### ğŸ“ Prompt Templates
- **Color Change**: Change color of selected area
- **Style Transfer**: Apply artistic style to selected area
- **Background Replace**: Replace background of selected area
- **Object Replace**: Replace selected object
- **Object Remove**: Remove selected object
- **Texture Change**: Change surface texture
- **Pose Change**: Adjust character pose
- **Expression Change**: Modify facial expression
- **Clothing Change**: Change clothing style
- **Environment Change**: Modify environment setting
- **Quality Enhancement**: Enhance image quality
- **Custom Operation**: User-defined editing instructions

## Installation & Usage

### ğŸ“¦ Installation

#### Method 1: Git Installation (Recommended)
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/aiaiaikkk/KontextVisualPromptWindow.git
```

#### Method 2: Manual Installation
1. Download and extract the project files
2. Copy the entire `KontextVisualPromptWindow` folder to `ComfyUI/custom_nodes/` directory

#### Complete Installation
Restart ComfyUI to use the plugin

### ğŸš€ Usage

#### Stage 1 Workflow (Current Version)

##### Basic Mode (Recommended)
```
LoadImage â†’ VisualPromptEditor
```
- **Features**: Manual annotation + basic prompt generation
- **Suitable for**: Precise annotation control, suitable for professional users

##### Complete Mode
```
LoadImage â†’ VisualPromptEditor â†’ LayerToMaskNode
```
- **Features**: Manual annotation + prompts + mask output
- **Suitable for**: Requires mask data for subsequent ComfyUI workflow

#### Stage 2 Workflow (Planned)

##### Intelligent Segmentation Mode
```
LoadImage â†’ SemanticSegmentationNode â†’ VisualPromptEditor â†’ AIPromptGenerator
```
- **Features**: Auto segmentation + manual adjustment + AI prompts
- **Suitable for**: Rapid processing, suitable for batch editing

##### Prompt Optimization Mode
```
LoadImage â†’ VisualPromptEditor â†’ PromptOptimizer â†’ QualityAnalyzer
```
- **Features**: Manual annotation + structured prompt optimization + quality assessment
- **Suitable for**: Professional users seeking optimal prompt effectiveness

#### Stage 3 Workflow (Conceptual)

##### Professional Grading Mode
```
LoadImage â†’ GlobalColorGrading â†’ LocalAnnotationEditing â†’ ProfessionalLightingAdjustment
```
- **Features**: Global grading + local editing + lighting adjustment
- **Suitable for**: Professional photographers and designers

### ğŸ¯ Operation Guide

#### Basic Operations
1. **Open Editor**: Double-click the `VisualPromptEditor` node
2. **Select Tool**: Click drawing tools in toolbar
3. **Select Color**: Click color buttons to select annotation color
4. **Toggle Style**: Click "Fill" button to toggle filled/outline
5. **Number Control**: Check/uncheck "Include annotation numbers" to control number display
6. **Draw Annotation**: Drag or click on image to draw
7. **Save & Apply**: Click "Save & Apply" to save data

#### Keyboard Shortcuts
- **Ctrl + Scroll**: Zoom image
- **Middle-click drag**: Pan image
- **Shift + Circle**: Draw perfect circle
- **Right-click**: Finish freehand drawing

## Node Description

### ğŸ¨ VisualPromptEditor
**Main Node**
- **Input**: IMAGE
- **Output**: Processed image, prompts, mask data, etc.
- **Function**: Visual annotation editing and prompt generation

### ğŸ¤– IntelligentAnnotationNode
**Intelligent Annotation Node**
- **Input**: IMAGE
- **Output**: Detected layer data JSON
- **Function**: Automatic object detection and region segmentation

### ğŸ­ LayerToMaskNode
**Layer to Mask Node**
- **Input**: Layer data JSON
- **Output**: ComfyUI mask format
- **Function**: Convert annotation data to masks


## License

MIT License - See LICENSE file for details

## Support

For issues or suggestions, please submit an Issue in the GitHub repository.

---

ğŸŒŸ **Kontext Visual Prompt Window** - Making image editing smarter and more intuitive!