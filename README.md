# Kontext Super Prompt

**[ä¸­æ–‡](#ä¸­æ–‡) | [English](#english)**

---

<a name="ä¸­æ–‡"></a>
## ä¸­æ–‡

**ComfyUIå›¾åƒç¼–è¾‘æç¤ºè¯ç”ŸæˆèŠ‚ç‚¹** - å¯è§†åŒ–æ ‡æ³¨å’ŒAIè¾…åŠ©æç¤ºè¯ç”Ÿæˆ

![Installation](images/instruction.png)

### ğŸ¯ ä¸»è¦åŠŸèƒ½

#### ğŸ¨ Super Canvas  
å¯è§†åŒ–ç”»å¸ƒæ ‡æ³¨å·¥å…·ï¼Œæ”¯æŒå›¾å±‚ç®¡ç†å’Œç»˜åˆ¶åŠŸèƒ½
- å¤šç§ç»˜åˆ¶å·¥å…·ï¼šç”»ç¬”ã€å½¢çŠ¶ã€æ–‡å­—ã€è£åˆ‡ç­‰
- ç”»ç¬”ç¾½åŒ–æ•ˆæœï¼šæ”¯æŒ1-20åƒç´ å¯è°ƒç¾½åŒ–åŠå¾„
- å›¾å±‚ç®¡ç†ï¼šæ·»åŠ ã€åˆ é™¤ã€è°ƒæ•´é¡ºåºã€ä¿®æ”¹å±æ€§
- å®æ—¶é¢„è§ˆï¼šç”»å¸ƒçŠ¶æ€å®æ—¶åŒæ­¥
- è¾“å‡ºç»“æ„åŒ–å›¾å±‚æ•°æ®ä¾›ä¸‹æ¸¸èŠ‚ç‚¹ä½¿ç”¨

![Super Canvas](images/LRPG_Canvas.png)

#### Super Prompt
æç¤ºè¯ç”Ÿæˆå™¨ï¼Œå°†å›¾å±‚ä¿¡æ¯è½¬æ¢ä¸ºç¼–è¾‘æŒ‡ä»¤
- **å…­ç§ç¼–è¾‘æ¨¡å¼**ï¼š
  - å±€éƒ¨ç¼–è¾‘ï¼šé’ˆå¯¹ç‰¹å®šåŒºåŸŸçš„ç²¾ç¡®ç¼–è¾‘
  - å…¨å±€ç¼–è¾‘ï¼šæ•´ä½“å›¾åƒé£æ ¼å’Œæ•ˆæœè°ƒæ•´
  - æ–‡å­—ç¼–è¾‘ï¼šæ–‡æœ¬å†…å®¹çš„æ·»åŠ å’Œä¿®æ”¹
  - é«˜çº§æ“ä½œï¼šé«˜çº§å›¾åƒå¤„ç†åŠŸèƒ½
  - è¿œç¨‹APIï¼šé›†æˆäº‘ç«¯AIæ¨¡å‹
  - æœ¬åœ°Ollamaï¼šä½¿ç”¨æœ¬åœ°å¤§è¯­è¨€æ¨¡å‹
- **40+æ“ä½œæ¨¡æ¿**ï¼šé¢œè‰²å˜æ¢ã€ç‰©ä½“ç§»é™¤ã€èƒŒæ™¯æ›¿æ¢ã€é£æ ¼è½¬æ¢ç­‰
- **æç¤ºè¯ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆçº¦æŸå’Œä¿®é¥°æç¤ºè¯
- **è‹±æ–‡è¾“å‡ºä¿è¯**ï¼šæ‰€æœ‰æ¨¡å¼å¼ºåˆ¶è¾“å‡ºè‹±æ–‡æç¤ºè¯

![Kontext Super Prompt](images/KontextSuperPrompt.png)

#### ç¼–è¾‘æ¨¡å¼ç•Œé¢å±•ç¤º

**å±€éƒ¨ç¼–è¾‘æ¨¡å¼** - ç²¾ç¡®çš„å¯¹è±¡çº§ç¼–è¾‘æ“ä½œ
![å±€éƒ¨ç¼–è¾‘](images/KontextSuperPrompt1.png)

**å…¨å±€ç¼–è¾‘æ¨¡å¼** - æ•´ä½“å›¾åƒé£æ ¼å’Œæ•ˆæœè°ƒæ•´
![å…¨å±€ç¼–è¾‘](images/KontextSuperPrompt2.png)

**æ–‡å­—ç¼–è¾‘æ¨¡å¼** - æ–‡æœ¬å†…å®¹çš„æ·»åŠ å’Œä¿®æ”¹
![æ–‡å­—ç¼–è¾‘](images/KontextSuperPrompt3.png)

**é«˜çº§æ“ä½œæ¨¡å¼** - é«˜çº§å›¾åƒå¤„ç†åŠŸèƒ½
![é«˜çº§æ“ä½œ](images/KontextSuperPrompt4.png)

**è¿œç¨‹APIæ¨¡å¼** - é›†æˆäº‘ç«¯AIæ¨¡å‹
![è¿œç¨‹API](images/KontextSuperPrompt5.png)

**æœ¬åœ°Ollamaæ¨¡å¼** - ä½¿ç”¨æœ¬åœ°å¤§è¯­è¨€æ¨¡å‹
![æœ¬åœ°Ollama](images/KontextSuperPrompt6.png)

#### ğŸ­ æ™ºèƒ½é¢éƒ¨å¤„ç†
ä¸“ä¸ºæ¢è„¸æ“ä½œè®¾è®¡çš„é«˜ç²¾åº¦é¢éƒ¨é¢„å¤„ç†ç³»ç»Ÿï¼ŒåŸºäºMediaPipeæŠ€æœ¯
- **åŒè„¸å¯¹é½ç®—æ³•**ï¼šæ™ºèƒ½è¯†åˆ«é¢éƒ¨å…³é”®ç‚¹ï¼Œå®ç°ç²¾ç¡®çš„é¢éƒ¨å¯¹é½ï¼Œä¸ºæ¢è„¸æ“ä½œæä¾›æœ€ä½³åŒ¹é…
- **çœ¼éƒ¨ä¼˜å…ˆç­–ç•¥**ï¼šä»¥åŒçœ¼ä¸ºåŸºå‡†è¿›è¡Œæ—‹è½¬å’Œç¼©æ”¾è®¡ç®—ï¼Œå†ç”¨é¼»å­/å˜´å·´ç²¾ç»†è°ƒæ•´ï¼Œç¡®ä¿æ¢è„¸è‡ªç„¶åº¦
- **å¤šç‰¹å¾ç‚¹è¯†åˆ«**ï¼šæ”¯æŒçœ¼éƒ¨ã€é¼»å­ã€å˜´å·´ã€è€³æœµç­‰å…³é”®é¢éƒ¨ç‰¹å¾ç‚¹æ£€æµ‹ï¼Œæå‡æ¢è„¸è´¨é‡
- **æ™ºèƒ½åæ ‡æ˜ å°„**ï¼šå‡†ç¡®å¤„ç†å›¾åƒå˜æ¢å’Œåæ ‡ç³»è½¬æ¢ï¼Œç¡®ä¿æ¢è„¸ä½ç½®ç²¾ç¡®å¯¹é½
- **é™çº§æ£€æµ‹æœºåˆ¶**ï¼šåœ¨MediaPipeä¸å¯ç”¨æ—¶æä¾›åŸºäºè‚¤è‰²çš„å¯å‘å¼æ£€æµ‹ï¼Œä¿è¯æ¢è„¸åŠŸèƒ½ç¨³å®šæ€§
- **å®æ—¶é¢„è§ˆè°ƒæ•´**ï¼šæ”¯æŒæ‰‹åŠ¨å¾®è°ƒå’ŒåŒ¹é…åº¦è¯„åˆ†ï¼Œä¼˜åŒ–æ¢è„¸å‰çš„é¢éƒ¨å¯¹é½æ•ˆæœ

![é¢éƒ¨å¤„ç†å·¥å…·1](images/face_tools_1.png)
![é¢éƒ¨å¤„ç†å·¥å…·2](images/face_tools_2.png)
![é¢éƒ¨å¤„ç†å·¥å…·3](images/face_tools_3.png)

### ğŸ¤– å¼•å¯¼è¯ç³»ç»Ÿ

#### ç¼–è¾‘æ„å›¾ç±»å‹ï¼ˆ16ç§æ“ä½œï¼‰
**æ‚¨æƒ³åšä»€ä¹ˆæ“ä½œï¼š**
- é¢œè‰²ä¿®æ”¹ã€ç‰©ä½“ç§»é™¤ã€ç‰©ä½“æ›¿æ¢ã€ç‰©ä½“æ·»åŠ 
- èƒŒæ™¯æ›´æ¢ã€æ¢è„¸ã€è´¨é‡å¢å¼ºã€å›¾åƒä¿®å¤
- é£æ ¼è½¬æ¢ã€æ–‡å­—ç¼–è¾‘ã€å…‰çº¿è°ƒæ•´ã€é€è§†æ ¡æ­£
- æ¨¡ç³Š/é”åŒ–ã€å±€éƒ¨å˜å½¢ã€æ„å›¾è°ƒæ•´ã€é€šç”¨ç¼–è¾‘

#### åº”ç”¨åœºæ™¯/é£æ ¼ï¼ˆ16ç§åœºæ™¯ï¼‰
**ç”¨äºä»€ä¹ˆåœºæ™¯ï¼š**
- ç”µå•†äº§å“ã€ç¤¾äº¤åª’ä½“ã€è¥é”€æ´»åŠ¨ã€äººåƒæ‘„å½±
- ç”Ÿæ´»æ–¹å¼ã€ç¾é£Ÿæ‘„å½±ã€æˆ¿åœ°äº§ã€æ—¶å°šé›¶å”®
- æ±½è½¦å±•ç¤ºã€ç¾å¦†åŒ–å¦†å“ã€ä¼ä¸šå“ç‰Œã€æ´»åŠ¨æ‘„å½±
- äº§å“ç›®å½•ã€è‰ºæœ¯åˆ›ä½œã€çºªå®æ‘„å½±ã€è‡ªåŠ¨é€‰æ‹©

### ğŸ“‹ ä½¿ç”¨æ–¹æ³•

#### åŸºç¡€å·¥ä½œæµ
1. æ·»åŠ `ğŸ¨ Super Canvas`èŠ‚ç‚¹ï¼Œè¿æ¥å›¾åƒè¾“å…¥
2. åœ¨ç”»å¸ƒä¸Šæ ‡æ³¨éœ€è¦ç¼–è¾‘çš„åŒºåŸŸ
3. æ·»åŠ `Super Prompt`èŠ‚ç‚¹
4. é€‰æ‹©ç¼–è¾‘æ¨¡å¼å’Œæ“ä½œç±»å‹
5. ç”Ÿæˆç¼–è¾‘æŒ‡ä»¤æˆ–ä½¿ç”¨AIå¢å¼ºåŠŸèƒ½

#### èŠ‚ç‚¹è¿æ¥
```
[å›¾åƒè¾“å…¥] â†’ [Super Canvas] â†’ [Super Prompt] â†’ [è¾“å‡ºæç¤ºè¯]
                    â†“                    â†“
                [æ ‡æ³¨å›¾åƒ]          [å›¾å±‚ä¿¡æ¯]
```

#### ä½¿ç”¨å»ºè®®

##### ä¸åŒåœºæ™¯é€‰æ‹©
- **äº§å“å›¾ç‰‡**ï¼šç¼–è¾‘æ„å›¾é€‰"é¢œè‰²ä¿®æ”¹" + åœºæ™¯é€‰"ç”µå•†äº§å“"
- **äººåƒç¾åŒ–**ï¼šç¼–è¾‘æ„å›¾é€‰"æ¢è„¸" + åœºæ™¯é€‰"äººåƒæ‘„å½±"
- **è¥é”€æµ·æŠ¥**ï¼šç¼–è¾‘æ„å›¾é€‰"é£æ ¼è½¬æ¢" + åœºæ™¯é€‰"è¥é”€æ´»åŠ¨"

##### APIä½¿ç”¨è¯´æ˜
1. åœ¨å¯¹åº”å¹³å°è·å–APIå¯†é’¥
2. åœ¨è¿œç¨‹APIé€‰é¡¹å¡è¾“å…¥å¯†é’¥
3. é€‰æ‹©æ¨¡å‹ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨è·å–å¯ç”¨æ¨¡å‹ï¼‰
4. è¾“å…¥ç¼–è¾‘æè¿°ï¼Œç‚¹å‡»ç”Ÿæˆ

##### Ollamaä½¿ç”¨è¯´æ˜
1. ç¡®ä¿å·²å®‰è£…Ollama
2. ç‚¹å‡»å¯åŠ¨æœåŠ¡æŒ‰é’®
3. é€‰æ‹©æœ¬åœ°æ¨¡å‹
4. è¾“å…¥æè¿°ï¼Œç”Ÿæˆæç¤ºè¯

### ğŸ› ï¸ å®‰è£…

#### æ–¹æ³•1ï¼šé€šè¿‡ComfyUI Managerï¼ˆæ¨èï¼‰
1. æ‰“å¼€ComfyUI Manager
2. æœç´¢ "Kontext Super Prompt"
3. ç‚¹å‡»å®‰è£…

#### æ–¹æ³•2ï¼šGitå…‹éš†
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/aiaiaikkk/super-prompt-canvas.git
```

#### æ–¹æ³•3ï¼šæ‰‹åŠ¨å®‰è£…
1. ä¸‹è½½é¡¹ç›®ZIPæ–‡ä»¶
2. è§£å‹åˆ° `ComfyUI/custom_nodes/` ç›®å½•
3. é‡å¯ComfyUI

### ğŸ“¦ ä¾èµ–è¦æ±‚

- ComfyUI (æœ€æ–°ç‰ˆæœ¬)
- Python 3.8+
- PyTorch 1.12+
- Ollama (å¯é€‰ï¼Œç”¨äºæœ¬åœ°æ¨¡å‹)

### ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å®‰è£…èŠ‚ç‚¹åŒ…**ï¼šé€šè¿‡ä¸Šè¿°ä»»ä¸€æ–¹æ³•å®‰è£…
2. **é‡å¯ComfyUI**ï¼šç¡®ä¿èŠ‚ç‚¹æ­£ç¡®åŠ è½½
3. **æ·»åŠ èŠ‚ç‚¹**ï¼šåœ¨èŠ‚ç‚¹èœå•ä¸­æ‰¾åˆ° "kontext_super_prompt" åˆ†ç±»
4. **åˆ›å»ºå·¥ä½œæµ**ï¼šæŒ‰ç…§ä½¿ç”¨æ–¹æ³•è¿æ¥èŠ‚ç‚¹
5. **å¼€å§‹ä½¿ç”¨**ï¼šæ ‡æ³¨å›¾åƒï¼Œç”Ÿæˆæç¤ºè¯

### ğŸ¤– å…¶ä»–èŠ‚ç‚¹

#### TextGen WebUI Flux Kontext Enhancer
ä¸Text Generation WebUIçš„é›†æˆï¼Œæä¾›æç¤ºè¯å¢å¼ºåŠŸèƒ½ï¼š
- **è‡ªåŠ¨è¿æ¥**ï¼šè‡ªåŠ¨æ£€æµ‹TextGen WebUIæœåŠ¡çŠ¶æ€
- **åŒAPIæ”¯æŒ**ï¼šå…¼å®¹OpenAI APIå’ŒåŸç”ŸAPIæ¥å£
- **å¼•å¯¼ç³»ç»Ÿ**ï¼šå†…ç½®å•†ä¸šåœºæ™¯å¼•å¯¼è¯æ¨¡æ¿
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒå¤šä»»åŠ¡å¹¶è¡Œå¤„ç†
- **ç¼“å­˜ä¼˜åŒ–**ï¼šç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤è¯·æ±‚
- **ä½¿ç”¨æ–¹å¼**ï¼šå¯åŠ¨TextGen WebUIåï¼Œæ·»åŠ å¢å¼ºå™¨èŠ‚ç‚¹å³å¯ä½¿ç”¨

### ğŸ“– æ–‡æ¡£

- [å®‰è£…æŒ‡å—](INSTALLATION.md)
- [ç¤ºä¾‹å·¥ä½œæµ](examples/)

### ğŸ”— é“¾æ¥

- [GitHubä»“åº“](https://github.com/aiaiaikkk/super-prompt-canvas)
- [é—®é¢˜åé¦ˆ](https://github.com/aiaiaikkk/super-prompt-canvas/issues)

---

<a name="english"></a>
## English

**ComfyUI Image Editing Prompt Generation Node** - Visual annotation and AI-assisted prompt generation

![Installation](images/instruction.png)

### ğŸ¯ Main Features

#### ğŸ¨ Super Canvas
Visual canvas annotation tool with layer management and drawing capabilities
- Multiple drawing tools: brush, shapes, text, crop, etc.
- Brush feathering effect: adjustable feather radius from 1-20 pixels
- Layer management: add, delete, reorder, modify properties
- Real-time preview: canvas state synchronization
- Output structured layer data for downstream nodes

![Super Canvas](images/LRPG_Canvas.png)

#### Super Prompt
Prompt generator that converts layer information into editing instructions
- **Six editing modes**:
  - Local editing: precise region-specific editing
  - Global editing: overall image style and effect adjustments
  - Text editing: text content addition and modification
  - Advanced operations: advanced image processing features
  - Remote API: integrated cloud AI models
  - Local Ollama: use local large language models
- **40+ operation templates**: color transformation, object removal, background replacement, style transfer, etc.
- **Prompt generation**: automatic generation of constraints and modifier prompts
- **English output guarantee**: all modes force English prompt output

![Kontext Super Prompt](images/KontextSuperPrompt.png)

#### Editing Mode Interface Display

**Local Editing Mode** - Precise object-level editing operations
![Local Editing](images/KontextSuperPrompt1.png)

**Global Editing Mode** - Overall image style and effect adjustments
![Global Editing](images/KontextSuperPrompt2.png)

**Text Editing Mode** - Text content addition and modification
![Text Editing](images/KontextSuperPrompt3.png)

**Advanced Operations Mode** - Advanced image processing features
![Advanced Operations](images/KontextSuperPrompt4.png)

**Remote API Mode** - Integrated cloud AI models
![Remote API](images/KontextSuperPrompt5.png)

**Local Ollama Mode** - Use local large language models
![Local Ollama](images/KontextSuperPrompt6.png)

#### ğŸ­ Intelligent Face Processing
High-precision face preprocessing system designed for face swapping operations, based on MediaPipe technology
- **Dual face alignment algorithm**: Intelligent identification of facial key points for precise face alignment, providing optimal matching for face swapping
- **Eye-priority strategy**: Rotation and scaling calculations based on eyes, with nose/mouth fine-tuning to ensure natural face swapping
- **Multi-feature point recognition**: Supports detection of key facial features including eyes, nose, mouth, ears, improving face swapping quality
- **Intelligent coordinate mapping**: Accurate handling of image transformation and coordinate system conversion, ensuring precise face swapping alignment
- **Fallback detection mechanism**: Provides skin color-based heuristic detection when MediaPipe is unavailable, ensuring stable face swapping functionality
- **Real-time preview adjustment**: Supports manual fine-tuning and matching score, optimizing face alignment before swapping

![Face Processing Tools 1](images/face_tools_1.png)
![Face Processing Tools 2](images/face_tools_2.png)
![Face Processing Tools 3](images/face_tools_3.png)

### ğŸ¤– Guided Prompt System

#### Editing Intent Types (16 operations)
**What operation do you want to perform:**
- Color modification, Object removal, Object replacement, Object addition
- Background replacement, Face swapping, Quality enhancement, Image restoration
- Style transfer, Text editing, Lighting adjustment, Perspective correction
- Blur/Sharpen, Local deformation, Composition adjustment, General editing

#### Application Scenarios/Styles (16 scenarios)
**What scenario to use for:**
- E-commerce products, Social media, Marketing campaigns, Portrait photography
- Lifestyle, Food photography, Real estate, Fashion retail
- Automotive display, Beauty cosmetics, Corporate branding, Event photography
- Product catalog, Artistic creation, Documentary photography, Auto-select

### ğŸ“‹ Usage

#### Basic Workflow
1. Add `ğŸ¨ Super Canvas` node, connect image input
2. Annotate regions to edit on canvas
3. Add `Super Prompt` node
4. Select editing mode and operation type
5. Generate editing instructions or use AI enhancement features

#### Node Connection
```
[Image Input] â†’ [Super Canvas] â†’ [Super Prompt] â†’ [Output Prompt]
                      â†“                    â†“
                [Annotated Image]     [Layer Info]
```

#### Usage Suggestions

##### Different Scenario Selection
- **Product Images**: Select "Color Modification" for editing intent + "E-commerce Products" for scenario
- **Portrait Enhancement**: Select "Face Swapping" for editing intent + "Portrait Photography" for scenario
- **Marketing Posters**: Select "Style Transfer" for editing intent + "Marketing Campaigns" for scenario

##### API Usage Instructions
1. Obtain API key from corresponding platform
2. Enter key in Remote API tab
3. Select model (system will automatically fetch available models)
4. Input editing description, click generate

##### Ollama Usage Instructions
1. Ensure Ollama is installed
2. Click start service button
3. Select local model
4. Input description, generate prompt

### ğŸ› ï¸ Installation

#### Method 1: Via ComfyUI Manager (Recommended)
1. Open ComfyUI Manager
2. Search for "Kontext Super Prompt"
3. Click Install

#### Method 2: Git Clone
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/aiaiaikkk/super-prompt-canvas.git
```

#### Method 3: Manual Installation
1. Download project ZIP file
2. Extract to `ComfyUI/custom_nodes/` directory
3. Restart ComfyUI

### ğŸ“¦ Requirements

- ComfyUI (latest version)
- Python 3.8+
- PyTorch 1.12+
- Ollama (optional, for local models)

### ğŸš€ Quick Start

1. **Install node package**: Install via any method above
2. **Restart ComfyUI**: Ensure nodes are loaded correctly
3. **Add nodes**: Find "kontext_super_prompt" category in node menu
4. **Create workflow**: Connect nodes according to usage method
5. **Start using**: Annotate images, generate prompts

### ğŸ¤– Other Nodes

#### TextGen WebUI Flux Kontext Enhancer
Integration with Text Generation WebUI, providing prompt enhancement features:
- **Auto-connect**: Automatically detect TextGen WebUI service status
- **Dual API support**: Compatible with OpenAI API and native API interfaces
- **Guidance system**: Built-in commercial scenario prompt templates
- **Batch processing**: Support for parallel multi-task processing
- **Cache optimization**: Caching mechanism to reduce duplicate requests
- **Usage**: After starting TextGen WebUI, add enhancer node to use

### ğŸ“– Documentation

- [Installation Guide](INSTALLATION.md)
- [Example Workflows](examples/)

### ğŸ”— Links

- [GitHub Repository](https://github.com/aiaiaikkk/super-prompt-canvas)
- [Issue Tracker](https://github.com/aiaiaikkk/super-prompt-canvas/issues)

---

**Version**: 1.4.4
**Author**: aiaiaikkk